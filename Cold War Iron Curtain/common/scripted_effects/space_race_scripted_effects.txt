# coded by Harain
calculate_mission_time = {
	set_variable = { root.confirmed_time_part_1 = root.calculated_time }
	multiply_variable = { root.confirmed_time_part_1 = 0.3 }
	round_variable = root.confirmed_time_part_1
	set_variable = { root.confirmed_time_part_2 = root.calculated_time }
	multiply_variable = { root.confirmed_time_part_2 = 0.3 }
	round_variable = root.confirmed_time_part_2
	set_variable = { root.confirmed_time_part_3 = root.calculated_time }
	multiply_variable = { root.confirmed_time_part_3 = 0.3 }
	round_variable = root.confirmed_time_part_3
}
calculate_risk = {
	set_variable = { root.confirmed_risk_1 = root.calculated_risk }
	set_variable = { root.confirmed_risk_2 = 1 }
	subtract_from_variable = { root.confirmed_risk_2 = root.calculated_risk  }
	multiply_variable = { root.confirmed_risk_1 = 100 }
	multiply_variable = { root.confirmed_risk_2 = 100 }
	round_variable = root.confirmed_risk_2
	round_variable = root.confirmed_risk_1
}
calculate_breakthrough = {
	set_variable = { root.confirmed_bt_1 = root.calculated_breakthrough_chance }
	set_variable = { root.confirmed_bt_2 = 1 }
	subtract_from_variable = { root.confirmed_bt_2 = root.calculated_breakthrough_chance  }
	multiply_variable = { root.confirmed_bt_1 = 100 }
	multiply_variable = { root.confirmed_bt_2 = 100 }
	round_variable = root.confirmed_bt_1
	round_variable = root.confirmed_bt_2
}
calculate_space_effect = {
	set_variable = { root.calculated_risk = 0 }
	set_variable = { root.budget_r = root.currentbudget }
	multiply_variable = { root.budget_r = 0.001 }
	add_to_variable = { root.calculated_risk = root.chosen_mission_r }
	add_to_variable = { root.calculated_risk = root.chosen_launchvehicle_r }
	add_to_variable = { root.calculated_risk = root.chosen_space_craft_r }
	subtract_from_variable = { root.calculated_risk = root.budget_r  }
	clamp_variable = {
		var = root.calculated_risk
		min = 0.01
		max = 1
	}
	set_variable = { root.calculated_cost = 0 }
	set_variable = { root.budget_c = root.currentbudget }
	multiply_variable = { root.budget_c = 0.1 }
	add_to_variable = { root.calculated_cost = root.chosen_mission_c }
	add_to_variable = { root.calculated_cost = root.chosen_launchvehicle_c }
	add_to_variable = { root.calculated_cost = root.chosen_space_craft_c }
	subtract_from_variable = { root.calculated_cost = root.budget_c  }
	clamp_variable = {
		var = root.calculated_cost
		min = 1
	}
	set_variable = { root.calculated_time = 0 }
	set_variable = { root.budget_t = root.currentbudget }
	multiply_variable = { root.budget_t = 0.3 }
	add_to_variable = { root.calculated_time = root.chosen_mission_t }
	add_to_variable = { root.calculated_time = root.chosen_launchvehicle_t }
	add_to_variable = { root.calculated_time = root.chosen_space_craft_t }
	subtract_from_variable = { root.calculated_time = root.budget_t  }
	clamp_variable = {
		var = root.calculated_time
		min = 30
	}
	set_variable = { root.calculated_breakthrough_chance = 0 }
	set_variable = { root.budget_b = root.currentbudget }
	multiply_variable = { root.budget_b = 0.001 }
	multiply_variable = { root.budget_b = 0.2 }
	add_to_variable = { root.calculated_breakthrough_chance = root.chosen_mission_b }
	add_to_variable = { root.calculated_breakthrough_chance = root.chosen_space_craft_b }
	add_to_variable = { root.calculated_breakthrough_chance = root.budget_b  }
	clamp_variable = {
		var = root.calculated_breakthrough_chance
		min = 0.01
	}
}
clear_calculated = {
	clear_variable = calculated_risk
	clear_variable = calculated_cost
	clear_variable = calculated_time
	clear_variable = calculated_breakthrough_chance
}
save_ship = {
	set_variable = { root.saved_ship = root.selected_spacecraft }
	set_variable = { root.saved_mission  = root.selected_mission }
	set_variable = { root.saved_vehicle = root.selected_launchvehicle }
}
clear_ships = {
	clear_variable = saved_ship
	clear_variable = saved_mission
	clear_variable = saved_vehicle
}
reset_choices = {
	clear_variable = mission_blocked
	clear_variable = chosen_mission_r
	clear_variable = chosen_mission_c
	clear_variable = chosen_mission_t
	clear_variable = chosen_mission_b
	clear_variable = launchvehicle_blocked
	clear_variable = chosen_launchvehicle_r
	clear_variable = chosen_launchvehicle_c
	clear_variable = chosen_launchvehicle_t
	clear_variable = spacecraft_type_blocked
	clear_variable = chosen_space_craft_r
	clear_variable = chosen_space_craft_c
	clear_variable = chosen_space_craft_t
	clear_variable = chosen_space_craft_b
	clear_variable = selected_spacecraft
	clear_variable = selected_launchvehicle
	clear_variable = selected_mission
}
clear_spacecraft = {
	set_variable = { spacecraft_tex = 0 }
	clear_variable = spacecraft_risk
	clear_variable = spacecraft_cost
	clear_variable = spacecraft_time
	clear_variable = spacecraft_breakthrough_chance
}
refresh_space_gui = {
	if = {
		limit = {
			check_variable = { ROOT.refresh_space_race_main = 1 }
		}
		set_variable = { ROOT.refresh_space_race_main = 0 }
	}
	else = {
		set_variable = { ROOT.refresh_space_race_main = 1 }
	}
}
clear_mission = {
	set_variable = { mission_tex = 0 }
	clear_variable = mission_risk
	clear_variable = mission_cost
	clear_variable = mission_time
	clear_variable = mission_breakthrough_chance
}
clear_launchvehicle = {
	set_variable = { launchvehicle_tex = 0 }
	clear_variable = launchvehicle_risk
	clear_variable = launchvehicle_cost
	clear_variable = launchvehicle_time
}
space_race_get_top_5 = {
	clear_array = global.top_space_race_array_country
	clear_array = global.top_space_race_array_num_decisions

	# top country
	log = "  Number of countries in Space Race: [?global.space_race_array_country^num]"
	set_temp_variable = { temp_max = 0 }
	set_temp_variable = { temp_max_country_index = 0 }
	for_loop_effect = {
		end = global.space_race_array_country^num
		value = v
		if = {
			limit = { check_variable = { global.space_race_array_num_decisions^v > temp_max } }
			set_temp_variable = { temp_max = global.space_race_array_num_decisions^v }
			set_temp_variable = { temp_max_country_index = v }
		}
		#log = "      1st loop [?v]: country [?global.space_race_array_country^v.GetTag] - num [?global.space_race_array_num_decisions^v] - current max: [?temp_max] in index [?temp_max_country_index]"
	}
	add_to_array = { global.top_space_race_array_country = global.space_race_array_country^temp_max_country_index }
	add_to_array = { global.top_space_race_array_num_decisions = global.space_race_array_num_decisions^temp_max_country_index }
	log = "    top Country: [?global.top_space_race_array_country^0.GetTag] - Missions: [?global.top_space_race_array_num_decisions^0]"

	# 2nd country
	if = { limit = { check_variable = { global.space_race_array_country^num > 1 } }
		set_temp_variable = { temp_max = 0 }
		set_temp_variable = { temp_max_country_index = 0 }
		for_loop_effect = {
			end = global.space_race_array_country^num
			value = v
			if = { limit = { NOT = { check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^0 } } }
				if = {
					limit = { check_variable = { global.space_race_array_num_decisions^v > temp_max } }
					set_temp_variable = { temp_max = global.space_race_array_num_decisions^v }
					set_temp_variable = { temp_max_country_index = v }
				}
				#log = "      2nd loop [?v]: country [?global.space_race_array_country^v.GetTag] - num [?global.space_race_array_num_decisions^v] - current max: [?temp_max] in index [?temp_max_country_index]"
			}
		}
		add_to_array = { global.top_space_race_array_country = global.space_race_array_country^temp_max_country_index }
		add_to_array = { global.top_space_race_array_num_decisions = global.space_race_array_num_decisions^temp_max_country_index }
		log = "    2nd Country: [?global.top_space_race_array_country^1.GetTag] - Missions: [?global.top_space_race_array_num_decisions^1]"
	}

	# 3rd country
	if = { limit = { check_variable = { global.space_race_array_country^num > 2 } }
		set_temp_variable = { temp_max = 0 }
		set_temp_variable = { temp_max_country_index = 0 }
		for_loop_effect = {
			end = global.space_race_array_country^num
			value = v
			if = {
				limit = {
					NOT = {
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^0 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^1 }
					}
				}
				if = {
					limit = { check_variable = { global.space_race_array_num_decisions^v > temp_max } }
					set_temp_variable = { temp_max = global.space_race_array_num_decisions^v }
					set_temp_variable = { temp_max_country_index = v }
				}
				#log = "      3rd loop [?v]: country [?global.space_race_array_country^v.GetTag] - num [?global.space_race_array_num_decisions^v] - current max: [?temp_max] in index [?temp_max_country_index]"
			}
		}
		add_to_array = { global.top_space_race_array_country = global.space_race_array_country^temp_max_country_index }
		add_to_array = { global.top_space_race_array_num_decisions = global.space_race_array_num_decisions^temp_max_country_index }
		log = "    3rd Country: [?global.top_space_race_array_country^2.GetTag] - Missions: [?global.top_space_race_array_num_decisions^2]"
	}

	# 4th country
	if = { limit = { check_variable = { global.space_race_array_country^num > 3 } }
		set_temp_variable = { temp_max = 0 }
		set_temp_variable = { temp_max_country_index = 0 }
		for_loop_effect = {
			end = global.space_race_array_country^num
			value = v
			if = {
				limit = {
					NOT = {
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^0 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^1 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^2 }
					}
				}
				if = {
					limit = { check_variable = { global.space_race_array_num_decisions^v > temp_max } }
					set_temp_variable = { temp_max = global.space_race_array_num_decisions^v }
					set_temp_variable = { temp_max_country_index = v }
				}
				#log = "      4th loop [?v]: country [?global.space_race_array_country^v.GetTag] - num [?global.space_race_array_num_decisions^v] - current max: [?temp_max] in index [?temp_max_country_index]"
			}
		}
		add_to_array = { global.top_space_race_array_country = global.space_race_array_country^temp_max_country_index }
		add_to_array = { global.top_space_race_array_num_decisions = global.space_race_array_num_decisions^temp_max_country_index }
		log = "    4th Country: [?global.top_space_race_array_country^3.GetTag] - Missions: [?global.top_space_race_array_num_decisions^3]"
	}

	# 5th country
	if = { limit = { check_variable = { global.space_race_array_country^num > 4 } }
		set_temp_variable = { temp_max = 0 }
		set_temp_variable = { temp_max_country_index = 0 }
		for_loop_effect = {
			end = global.space_race_array_country^num
			value = v
			if = {
				limit = {
					NOT = {
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^0 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^1 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^2 }
						check_variable = { global.space_race_array_country^v = global.top_space_race_array_country^3 }
					}
				}
				if = {
					limit = { check_variable = { global.space_race_array_num_decisions^v > temp_max } }
					set_temp_variable = { temp_max = global.space_race_array_num_decisions^v }
					set_temp_variable = { temp_max_country_index = v }
				}
				#log = "      5th loop [?v]: country [?global.space_race_array_country^v.GetTag] - num [?global.space_race_array_num_decisions^v] - current max: [?temp_max] in index [?temp_max_country_index]"
			}
		}
		add_to_array = { global.top_space_race_array_country = global.space_race_array_country^temp_max_country_index }
		add_to_array = { global.top_space_race_array_num_decisions = global.space_race_array_num_decisions^temp_max_country_index }
		log = "    5th Country: [?global.top_space_race_array_country^4.GetTag] - Missions: [?global.top_space_race_array_num_decisions^4]"
	}
}


#Space Research Stuff by Swf
research_space_tech_launch = {
	subtract_from_variable = {
		space_tech_being_researched_year_modifier = global.year
	}
	add_to_variable = {
		space_tech_being_researched_year_modifier = 1
	}
	set_variable = {
		test_research_speed = space_tech_being_researched_year_modifier
	}
	if = {
		limit = {
			check_variable = {
				space_tech_being_researched_year_modifier < 1
			}
			check_variable = {
				space_tech_being_researched_year_modifier > 0
			}
		}
		set_variable = {
			space_tech_being_researched_year_modifier = 0
		}
		add_to_variable = {
			space_tech_being_researched_year_modifier = 219
		}

	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_year_modifier < 0
			}
		}
		multiply_variable = {
			space_tech_being_researched_year_modifier = 0.10
		}
		set_variable = {
			test_three_for_space = space_tech_being_researched_year_modifier
		}
		multiply_variable = {
			space_tech_being_researched_year_modifier = 219
		}
		add_to_variable = {
			space_tech_being_researched_year_modifier = 219
		}
	}
	else = {
		divide_variable = {
			space_tech_being_researched_year_modifier = 2
		}
		multiply_variable = {
			space_tech_being_researched_year_modifier = 219
		}
		add_to_variable = {
			space_tech_being_researched_year_modifier = 219
		}
	}

}
research_space_tech_budget_calculation = {
	set_variable = { show_space_tech_category_id = 0 }
	set_variable = {
		space_research_budget_modifier = currentbudget
	}
	multiply_variable = {
		space_research_budget_modifier = 2
	}
	divide_variable = {
		space_research_budget_modifier = 100
	}
	if = {
		limit = {
			check_variable = {
				space_research_budget_modifier < 1
			}
		}
		add_to_variable = {
			space_research_budget_modifier = 1
		}
		multiply_variable = {
			space_tech_being_researched_year_modifier = space_research_budget_modifier
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_research_budget_modifier > 1
			}	
		}
		add_to_variable = {
			space_research_budget_modifier = -1
		}
		divide_variable = {
			space_research_budget_modifier = 2
		}
		set_variable = {
			space_tech_being_researched_year_modifier_calc = space_tech_being_researched_year_modifier
		}
		multiply_variable = {`
			space_tech_being_researched_year_modifier_calc = space_research_budget_modifier
		}
		subtract_from_variable = {
			space_tech_being_researched_year_modifier = space_tech_being_researched_year_modifier_calc
		}
	}
}

get_space_budget_max = {
	set_variable = {
		space_budget_cap = amount_research_slots
	}
	multiply_variable = {
		space_budget_cap = 10
	}
	set_variable = {
		space_budget_cap_shift = space_budget_cap
	}
	subtract_from_variable = {
		space_budget_cap_shift = 9
	}
}

space_research_completed = {
	if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 1
			}
		}
		add_to_array = {
			structural_components_researched = space_tech_being_researched
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 2
			}
		}	
		add_to_array = {
			power_components_researched = space_tech_being_researched
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 3
			}
		}	
		add_to_array = {
			data_components_researched = space_tech_being_researched
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 4
			}
		}	
		add_to_array = {
			chemical_propulsion_components_researched = space_tech_being_researched
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 5
			}
		}	
		add_to_array = {
			electricity_propulsion_components_researched = space_tech_being_researched
		}
	}
	else_if = {
		limit = {
			check_variable = {
				space_tech_being_researched_category = 6
			}
		}	
		add_to_array = {
			nuclear_propulsion_components_researched = space_tech_being_researched
		}
	}
	else = { }
}